package com.webtoon.spring.controller;

import java.util.HashMap;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

import com.webtoon.spring.domain.UserVO;
import com.webtoon.spring.service.LoginService;

@Controller
@RequestMapping("/")
public class LoginController {

	

	@Autowired
	private LoginService loginService;
	
	
	@RequestMapping("loginUser")
	public String dologin(Model model,HttpServletRequest request,HttpSession session) {
		
		
		String id= request.getParameter("input_id");
		String pw=request.getParameter("input_pwd");
		
		Map param=new HashMap();
		
		param.put("id",id);
		param.put("pw",pw);
		
		UserVO loginUser = loginService.loginUser(param);
		
		if(loginUser!=null) {
			System.out.println(">>>>>"+loginUser.getId());
			System.out.println(">>>>>"+loginUser.getPw());
			//로그인 이제 추가 세션 할당
			session.setAttribute("session_ok", "ok");
			session.setAttribute("session_id",id);
			return "redirect:home";

			
		}else {
			System.out.println(">>>"+"null");
			//로그인 실패시 처리 필요
			if(session.getAttribute("session_ok")!=null) {
				session.removeAttribute("session_ok");
				
				return "redirect:login";
			}
			
			
		}
		

		
		
		
		
	}
	
	
	
	
}
